
{% extends "base/base.html" %}
{% load staticfiles %}
{% load components %}
{% block title %} Scripts {% endblock %}
{% block premain %}
<div id="deleteWarning" class="modal fade" role="dialog">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Deletion Warning!</h4>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <div class="modal-body">
            </div>
            <div class="modal-footer">
                <button type='button' class='btn btn-info' id='deleteScriptModalButton'>OK</button>
                <button type='reset' class='btn btn-danger' data-dismiss='modal'>Cancel</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block content %}
<div class="ml-4 mr-4">
    <div class="col col-xs-12 col-sm-12 col-md-3 col-xl-2 col-lg-3 mb-4">
        <div class="row-2 form-group">
            <label class="client-header font-weight-bold">
                SCRIPTS
                <button class="btn inline-add-button script-action-add">
                    <i class="mdi mdi-plus font-weight-bold"></i>
                </button>
            </label>
        </div>

        <div class="row-2">
            <ul class="nav flex-column col" id="scriptTabList" role="tablist">
                <li class="nav-item" style="display: none;">
                    <a class="nav-link font-weight-bold script-tab-link" id="scriptTabNew" data-toggle="tab" href="#scriptTabContentNew" role="tab">
                    </a>
                </li>

                {% for script in scripts %}
                    <li class="nav-item mb-2 pt-2 pb-2 pr-4 pl-4 fsim-box" data-state="unknown">
                        <a class="nav-link font-weight-bold script-tab-link" id="scriptTab{{ script.id }}" data-toggle="tab" href="#scriptTabContent{{ script.id }}" role="tab">
                            <i class="mdi mdi-description"></i>
                            {{ script.name }}
                        </a>
                    </li>
                {% endfor %}
            </ul>
        </div>
    </div>

    <div class="container-fluid tab-content col col-xs-12 col-sm-12 col-md-8 col-lg-8 col-xl-9">
        <div class="tab-pane fade show" role="tabpanel"  id="scriptTabContentNew">
            <div class="row mb-4">
                <div class="btn-toolbar col d-flex justify-content-end" role="toolbar">
                    <div class="btn-group mr-2" role="group">
                        <button type="button" class="btn btn-outline-dark program-action-add-save font-weight-light script-action-add-save" data-editor-id="new_script">
                            <i class="mdi mdi-check"></i> SAVE
                        </button>
                    </div>
                </div>
            </div>

            <div id="jsoneditor_new_script">
                <script>
                    newScript('new_script');
                </script>
            </div>
        </div>

        {% for script in scripts %}
            <div class="tab-pane fade show" id="scriptTabContent{{ script.id }}" role="tabpanel">
                {% script_entry script %}
            </div>
        {% empty %}
            <div class="tab-pane fade show active">
                <span class="background-text-large">No scripts created</span>
            </div>
        {% endfor %}
    </div>

</div>
{% endblock %}

{% block script %}
    {% verbatim %}
    <script id="template_entry" type="text/x-handlebars-template">
        <div class="list-group-item script-{{type}}-entry ">

            <div class="form-group row">
                <button class="btn script-{{type}}-remove inline-add-button" type="button">
                        <i class="mdi mdi-delete"></i>
                </button>
            </div>
            <div class="form-group row">
                <label class="col-2">Index</label>
                <div class="col">
                    <input class="form-control script-{{type}}-index" type="number" value="{{#if index}}{{index}}{{else}}0{{/if}}" required/>
                </div>
            </div>

            <div class="form-group row slave-choice">
                <label class="col-2">Client</label>
                <div class="col">
                    <select class="form-control script-{{type}}-slave" type="text" required>
                        {{#each slaves}}
                        <option {{#ifEq slave this}}selected{{/ifEq}}>{{this}}</option>
                        {{/each}}
                    </select>
                </div>
            </div>

            <div class="form-group row {{type}}-choice">
                <label class="col-2">{{#if type-display}}{{type-display}}{{else}}{{type}}{{/if}}</label>
                <div class="col">
                    <select class="form-control script-{{type}}-{{type}}" type="text" required {{#if selects}}{{else}}hidden{{/if}}>
                        {{#each selects}}
                        <option>{{this}}</option>
                        {{/each}}
                    </select>
                </div>
            </div>
        </div>
    </script>

    <script id="template_no_element" type="text/x-handlebars-template">
        <div class="list-group-item slave-no-elements">
            No Clients with {{type}}s created.
        </div>
    </script>

    <script id="template_container" type="text/x-handlebars-template">
        <div class="row form-group">
            <label class="col-2">Script Name</label>
            <div class="col">
                <input class="form-control script-name" type="text" {{#if name}}value="{{name}}"{{/if}} required/>
                <div class="invalid-feedback">Script name is required.</div>
            </div>
        </div>

        <div class="row">
            <div class="col-2">
                <label>Programs</label>
                <button type="button" class="btn script-program-add  inline-add-button">
                    <i class="mdi mdi-add"></i>
                </button>
            </div>

            <div class="script-program-content col list-group">
            </div>
        </div>

        <div class="row">
            <div class="col-2">
                <label>Files</label>
                <button type="button" class="btn script-file-add inline-add-button">
                    <i class="mdi mdi-add"></i>
                </button>
            </div>

            <div class="script-file-content col list-group">
            </div>
        </div>
    </script>
    {% endverbatim %}

    <script src="{% static 'node/handlebars/dist/handlebars.min.js' %}"></script>
    <script src="{% static 'frontend/jsonforms.js'%}"></script>

    <script src="{% static 'frontend/base.js'%}"></script>
    <script src="{% static 'frontend/scripts.js'%}"></script>
{% endblock %}