{% extends "base/base.html" %}
{% load staticfiles %}
{% load components %}
{% load widget_tweaks %}
{% block title %} Scripts {% endblock %}
{% block premain %}
{% endblock %}
{% block content %}

<div class="ml-4 mr-4">
    {% if not script %}
    <div>
        <span class="background-text-large">No scripts running</span>
        <br>
        <span class="background-text-normal">click run on a <a class="text-info" href="/scripts">script</a></span>
    </div>
    {% else %}
    <div>
        <h4 class="font-weight-bold text-uppercase">CURRENT STATUS</h4>
        <ul class="list-group">
            <li class="list-group-item fsim-progress" id="runInit{{ script.id }}" data-state="{% if script.is_initialized %}done{% else %}none{% endif %}">
                <i class="mdi"></i>
                <i class="fsim-progress-name">Initial</i>
            </li>

            <li class="list-group-item fsim-progress" id="runWaitSlaves{{ script.id }}" data-state="{% if script.is_initialized and script.is_running and script.current_index < 0 %}waiting{% elif script.current_index >= 0 %}done{% else %}{% if script.has_error %}error{% else %}none{% endif %}{% endif %}">
                <i class="mdi"></i>
                <i class="fsim-progress-name">Wait for Clients</i>
            </li>

            {% for index in script.indexes %}
            <li class="list-group-item fsim-progress" id="runStage{{ script.id }}_{{ query.index }}" data-state="{% if script.current_index > query.index %}done{% elif script.current_index == query.index %}{% if script.has_error %}error{% else %}waiting{% endif %}{% else %}none{% endif %}">
                <i class="mdi"></i>
                <i class="fsim-progress-name">Stage {{ index }}</i>
            </li>
            {% endfor %}

            <li class="list-group-item fsim-progress" id="runDone{{ script.id }}" data-state="{% if script.is_initialized and not script.is_running and not script.has_error %}done{% elif script.has_error %}error{% else %}none{% endif %}">
                <i class="mdi"></i>
                <i class="fsim-progress-name">Finished</i>
            </li>

        </ul>

        <button type="button" class="container-fluid btn btn-danger navbar-btn short-disable text-uppercase script-action-stop" data-script-id="{{ script.id }}" {% if script.is_initialized and not script.is_running and not script.has_error %}disabled{% elif script.has_error %}disabled{% else %}{% endif %}>
            <i class="mdi mdi-play-arrow"></i>
            <i class="button-status-display font-weight-bold">
                STOP
            </i>
        </button>

    </div>
    {% endif %}
</div>
{% endblock %}

{% block script %}
<script src="{% static 'frontend/scripts_run.js'%}"></script>
{% endblock %}
